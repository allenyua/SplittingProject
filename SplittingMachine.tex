%This section is currently written with Sp instead of Sp^J or Sp^D.  

Given a filtered spectrum $$X_0\longrightarrow X_1 \longrightarrow X_2 \longrightarrow \cdots ,$$ it will split if and only if there are maps going the other way: $$X_0 \longleftarrow X_1 \longleftarrow X_2 \longleftarrow \cdots,$$ with the property that the relevant composites are equivalences.  Motivated by this, one could ask: given an $\E_n$ filtered spectrum $X$, when is it $\E_n$-split?  In this section, we answer this question by proving the following:

%beware, perhaps not enough definitions are made for this statement to make sense; should probably also say either spectra or functors to spectra....
\begin{thm}\label{thm:SplitMachine}
Let $X\in \Alg_{\E_n}(\Fil)$ be an $\E_n$ filtered spectrum.  Suppose there exists an $\E_n$ cofiltered spectrum $Y\in \Alg_{\E_n}(\Cofil)$ with the following two properties:
\begin{enumerate}
\item There is an equivalence $\colim X \simeq \lim Y$ of $\E_n$-algebras in spectra.
\item The resulting natural maps $X_i \to Y_i$ are equivalences.  
\end{enumerate}
Then, the filtered spectrum $X$ is $\E_n$-split.
\end{thm}


%1. define the Fil, Fil_n^+, etc. categories and all the random monoidal functors and stuff

%For an indexing category I, we can form I^+; may need to mess around with this a bit to say it better
We will need a few preliminary definitions.  We start by fixing a positive integer $n$.  
Let $[n]$ denote the linearly ordered set of integers $0\leq i\leq n$. For any indexing 1-category $\mathcal{D}$, denote by $\mathcal{D}^{ds}$ the underlying discrete category, and denote by $\mathcal{D}^+$ the the category formed by formally adding a final object, which we will refer to as ``$+$''.  Define $\Fil_n^+ = \Fun([n]^+, \Sp)$ and $\Cofil_n^+ = \Fun(([n]^+)^{op},\Sp).$  These categories admit functors to $\Sp$ by restriction to the distinguished point.  We define $\C_n$ by the following pullback:

$$
\begin{tikzcd}
\C_n \arrow[r] \arrow[d]&  \Cofil_n^+ \arrow[d]\\
\Fil_n^+ \arrow[r]& \Sp
\end{tikzcd}
$$


%2. Write down the pullback; identify the full subcategory as the image of Gr_n x Sp^J.
An element of $\C_n$ can be thought of as a sequence of spectra connected by maps:
\begin{center}
$X_0 \longrightarrow X_1 \longrightarrow \cdots \longrightarrow X_n \longrightarrow X \simeq Y \longrightarrow Y_n \longrightarrow \cdots \longrightarrow Y_1 \longrightarrow Y_0$
\end{center}
where the middle arrow is an equivalence, as indicated.  This is equivalent to just considering sequences
\begin{center}
$X_0 \longrightarrow X_1 \longrightarrow \cdots \longrightarrow X_n \longrightarrow Z \longrightarrow Y_n \longrightarrow \cdots \longrightarrow Y_1 \longrightarrow Y_0$,
\end{center}
and so we shall refer to general elements by these names below.   


Define the subcategory $\mathcal{G}_n\subset \C_n$ as the full subcategory such that for each integer $0\leq i\leq n$, the composite $X_i \longrightarrow Y_i$ is an equivalence.  

\begin{lem}
There is an equivalence $$\mathcal{G}_n \simeq \Gr_n^+ := \Fun(([n]^{+})^{ds}, \Sp),$$
where $([n]^+)^{ds}$ is, as usual, the underlying set of $[n]^+$.  
\end{lem}
\begin{proof}
We proceed by induction on $n$.  

For $n=0$, we are considering the full subcategory of diagrams $X_0 \to Z \to Y_0$ of spectra with the property that the composite is an equivalence.  By taking the fiber of the second map, this is equivalent to the category of triples $(X_0, Y_0',Z)$ of spectra together with an equivalence $X_0 \vee Y_0' \xrightarrow{\sim} Z.$   This is  certainly equivalent to the category of pairs $(X_0, Y_0')$ of spectra, which is $\Gr_0^+.$  

Next, assume the statement for $n\leq k$ and consider $\mathcal{G}_{k+1}.$  We consider the auxiliary category $\overline{\mathcal{G}}_{k+1}$ which is the full subcategory of $\C_{k+1}$ where only $X_{k+1} \to Y_{k+1}$ is stipulated to be an equivalence.    The argument for the base case shows that $$\overline{\mathcal{G}}_{k+1} = \Fil_{k+1} \times_{\Sp} \Gr_0^+ \times_{\Sp} \Cofil_{k+1}$$ where the fiber products are over the restriction to $0\in [0]^+$ for $\Gr_0^+$, and over $X_{k+1}$ and $Y_{k+1}$ in the filtered and cofiltered spectra.  By commuting the fiber products, we find that $$\overline{\mathcal{G}}_{k+1} = (\Fil_{k+1} \times_{\Sp} \Cofil_{k+1}) \times_{\Sp} \Gr_0^+  \simeq \C_k \times_{\Sp} \Gr_0^+$$ where we have implicitly used the identifications $\Fil_{k+1} \simeq \Fil_k^+$ and $\Cofil_{k+1} \simeq \Cofil_k^+.$   Under this equivalence, the full subcategory $\mathcal{G}_{k+1} \subset \overline{\mathcal{G}}_{k+1}$ corresponds to $\mathcal{G}_k \times_{\Sp} \Gr_0^+ \simeq \Gr_{k+1}^+$ as desired.  

\end{proof}



In fact, the functor $\Gr_n^+ \to \C_n$ can be seen very explicitly as follows: theres a functor $$I_n^+: \Gr_n^+ \to \Fil_n^+$$ given by left Kan extension along the inclusion $([n]^+)^{ds} \to [n]^+$ which is completely analogous to the functor $I$ described in Section \ref{sec:FilGra}.  Dually, there's a functor $$I_n^{op,+}:\Gr_n^+ \to \Cofil_n^+$$ given by right Kan extension along the inclusion $([n]^+)^{ds} \to ([n]^+)^{op}$ which sends an element $(X_0, X_1, \cdots, X_n, X)\in \Gr_n^+$ to $$X_0 \longleftarrow X_0\vee X_1 \longleftarrow \cdots \longleftarrow \bigvee_i X_i \longleftarrow X \vee \bigvee_i X_i.$$  These functors agree on restriction to the distinguished object, and so they define the desired functor $\Gr_n^+ \to \C_n.$  


%3. Identify everything as monoidal, then take the limit n-> \infty.

Until this point, we have been working with a fixed $n$ and without regard to the monoidal structure.  The results of Appendix \ref{app:day} allow us to analyze what happens as $n$ varies.   

In particular, give $[n]^+$ the structure of a symmetric monoidal category by taking $\Z_{\geq 0}$ under addition and identifying all the integers $m >n$ with the point $+$.  By Proposition \ref{prop:dayconvsmc}, this gives $\Fil_n^+$ the structure of a symmetric monoidal $\infty$-category.  There are natural symmetric monoidal functors $\Z_{\geq 0}^+ \to [n+1]^+ \to [n]^+$ by successive quotient.  By Proposition \ref{prop:kanmonoidal} combined with the commutative diagram of symmetric monoidal functors

$$
\begin{tikzcd}
(\lbrack n+1\rbrack^+)^{ds} \arrow[r] \arrow[d] & \lbrack n+1\rbrack^+ \arrow[d]\\
(\lbrack n\rbrack^+)^{ds} \arrow[r] & \lbrack n\rbrack^+ ,
\end{tikzcd}
$$
we obtain a commutative diagram of symmetric monoidal $\infty$-categories:
$$
\begin{tikzcd}
\Gr_{n+1}^+ \arrow[r,"I_{n+1}^+"] \arrow[d] & \Fil_{n+1}^+ \arrow[d]\\
\Gr_n^+  \arrow[r,"I_n^+"] & \Fil_n^+ .
\end{tikzcd}
$$
We claim that the limit of the right vertical arrows over $n$ is $\Fil^+ := \Fun(\Z_{\geq 0}^+,\Sp)$ with its symmetric monoidal structure as given by Proposition \ref{prop:dayconvsmc}.  This is because by Proposition \ref{prop:kanmonoidal}, there are symmetric monoidal functors $\Fil^+ \to \Fil_n^+$ induced by the symmetric monoidal functor $\Z_{\geq 0}^+ \to [n]^+$ collapsing $+$ and all integers $m> n$ to a point.  This induces a symmetric monoidal functor $\Fil^+ \to \lim_n \Fil_n^{+}.$  It is then easy to check that this is an equivalence.  
%We remark that the right vertical functor coincides with the restriction induced by the natural inclusion $[n] \to [n+1]$.   

There is a similar diagram for the cofiltered side by the appropriate analogs of the above statements:
$$
\begin{tikzcd}
\Gr_{n+1}^+ \arrow[r,"I_{n+1}^{op,+}"] \arrow[d] & \Cofil_{n+1}^+ \arrow[d]\\
\Gr_n^+  \arrow[r,"I_n^{op,+}"] & \Cofil_n^+ 
\end{tikzcd}
$$
and as before, we have an identification $ \Fun((\Z_{\geq 0}^{+})^{op}, \Sp) =: \Cofil^+ \simeq \lim_n \Cofil_n^+$ by Variant \ref{var:day} and Proposition \ref{prop:kanmonoidal}.

Thus, taking the limit in $n$ in the original picture yields a diagram of symmetric monoidal functors:

\begin{equation}\label{dia:fund}
\begin{tikzcd}
\mathcal{G}_\infty
 \arrow[drr, bend left, "I^{+,op}"]
  \arrow[ddr, bend right, "I^+"]
  \arrow[dr] & & \\
&\C_\infty \arrow[r] \arrow[d]&  \Cofil^+ \arrow[d]\\
& \Fil^+ \arrow[r]& \Sp
\end{tikzcd}
\end{equation}
where the square is Cartesian.

\begin{rmk}
While $\mathcal{G}_\infty \simeq \lim \Gr_n^{+}$, we warn the reader that $\mathcal{G}_\infty$ is not simply $\Fun((\Z_{\geq 0}^+)^{ds}, \Sp)$ because the maps in the inverse system for $\mathcal{G}_\infty$ are not just the ones induced by the inclusions $([n]^+)^{ds} \to ([n+1]^+)^{ds}.$
\end{rmk}

The functor $\mathcal{G}_\infty \to \mathcal{C}_\infty$ is fully faithful because it is the inverse limit of fully faithful functors.  Moreover, the essential image consists of those pairs $(X,Y)\in \Fil^+\times_{\Sp} \Cofil^+ = \C_{\infty}$ such that the natural maps $X_i\to Y_i$ are equivalences for all $i\geq 0$.   Since all the functors in the diagram \ref{dia:fund} were symmetric monoidal, this will remain the case on the level of algebras.  We therefore have for each integer $n\geq 0$ a diagram:

\begin{equation}\label{dia:fundmon}
\begin{tikzcd}
\Alg_{\E_n}(\mathcal{G}_\infty)
 \arrow[drr, bend left, "I^{+,op}"]
  \arrow[ddr, bend right, "I^+"]
  \arrow[dr] & & \\
&\Alg_{\E_n}(\C_\infty) \arrow[r] \arrow[d]&  \Alg_{\E_n}(\Cofil^+ )\arrow[d]\\
& \Alg_{\E_n}(\Fil^+ )\arrow[r]& \Alg_{\E_n}(\Sp)
\end{tikzcd}
\end{equation}
where the square is Cartesian and the functor $\Alg_{\E_n}(\mathcal{G}_\infty) \to \Alg_{\E_n}(\C_\infty)$ is fully faithful with essential image as described above.  


Recall that we were interested in understanding when an $\E_n$ filtered spectrum $X\in \Alg_{\E_n}(\Fil)$ is split - that is, when there exists $Z\in \Alg_{\E_n}(\Gr)$ such that $X \simeq IZ.$  The following proposition relates that to our current situation; informally, it allows us to get rid of the +'s.

\begin{prop}\label{prop:MonRet}
There exists a diagram of symmetric monoidal $\infty$-categories and symmetric monoidal functors 
$$
\begin{tikzcd}
&\mathcal{G}_\infty \arrow[r,"\pi"] \arrow[d, "I^+"]&  \Gr \arrow[d, "I"]\\
\Fil \arrow[r,"\iota"] & \Fil^+ \arrow[r,"\varpi"]& \Fil
\end{tikzcd}
$$
where the bottom row is a retract and $I^+$ is induced by the $I_n^+$ at each finite level.  
\end{prop} 
\begin{proof}

We have the square at each finite level: %ok this is not technically rigorous but I think it's totally obvious
$$
\begin{tikzcd}
\Gr_{n}^+ \arrow[r] \arrow[d,"I_n^{+}"] & \Gr_{n} \arrow[d,"I_n"]\\
\Fil_n^+  \arrow[r] & \Fil_n .
\end{tikzcd}
$$
where the right arrow comes from ignoring the $+$.  It is easy to see that all the functors are symmetric monoidal, and so taking the limit gives the square.  

For the bottom row, we apply Proposition \ref{prop:kanmonoidal} to the symmetric monoidal functor $q:\Z_{\geq 0} \to \Z_{\geq 0}^+.$  The functor $\varpi$ certainly coincides with $q_*$, and we define $\iota = q_!$, which is symmetric monoidal by Proposition \ref{prop:kanmonoidal}.  It is immediate that $\varpi \circ \iota$ is an equivalence, so the bottom row is a retract.  

%Finally, to see that $\pi$ is symmetric monoidal, we claim that at each finite level $n$, the functor $$\pi_n: \Gr_n^+ \to \Gr_n$$ is symmetric monoidal.  This is because the inclusion of the full subcategory of $\Gr_n^+$ which restricts to $0$ at the element $+\in ([n]^+)^{ds}$ induces a localization and the localization is clearly compatible with the monoidal structure (for example, see \cite[Proposition 2.2.1.9]{HA}).%need I say this more carefully?
\end{proof}

%On the cofiltered side, we need the following lemma:

We are now ready to prove the main result of this section.

\begin{proof}[Proof of Theorem \ref{thm:SplitMachine}]
We use the notations of Proposition \ref{prop:MonRet}.  Since $\iota$ is a symmetric monoidal functor, we obtain an $\E_n$ algebra $\iota X \in \Alg_{\E_n}(\Fil^+).$  
On the cofiltered side, we note that by the universal property of Day convolution, the symmetric monoidal functor $\Z_{\geq 0} \to \Z_{\geq 0}^+$ induces a map of $\infty$-operads $\Fun(\Z_{\geq 0}^+, \Sp^{op})^{\otimes} \to \Fun(\Z_{\geq 0},\Sp^{op})^{\otimes}.$  This amounts to an oplax symmetric monoidal functor $\Cofil^+\to \Cofil$ which restricts away from the $+$.  It is easy to see that this is actually a symmetric monoidal functor, and so its adjoint $\iota^{op}: \Cofil \to \Cofil^+$ by right Kan extension is lax monoidal.  Concretely, this is the functor which takes a cofiltered spectrum and adds in its limit.  As a result, we obtain an $\E_n$-algebra $\iota^{op}Y \in \Alg_{\E_n}(\Cofil^+)$ with image $\lim Y\in \Alg_{\E_n}(\Sp).$  

Condition (1) in the statement of the theorem guarantees that $\iota X$ and $\iota^{op}Y$ determine an element $\mathcal{X} \in \Alg_{\E_n}(\C_{\infty})$.  Condition (2) then ensures that $\mathcal{X}$ is in the essential image of the fully faithful functor $\Alg_{\E_n}(\mathcal{G}_\infty) \to \Alg_{\E_n}(\C_\infty)$; consequently, we regard $\mathcal{X}$ as an $\E_n$-algebra in $\mathcal{G}_{\infty}$.  Finally, we chase through the diagram of Proposition \ref{prop:MonRet} to see that $I\pi \mathcal{X} \simeq \varpi I^+ \mathcal{X} \simeq \varpi \iota X \simeq X$ as $\E_n$-algebras in $\Fil$.   Hence, $X$ is $\E_n$ split, as desired. 
\end{proof}




