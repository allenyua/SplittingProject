%This section is currently written with Sp instead of Sp^J or Sp^D.  

Given a filtered spectrum $$X_0\longrightarrow X_1 \longrightarrow X_2 \longrightarrow \cdots ,$$ it will split if and only if there are maps going the other way: $$X_0 \longleftarrow X_1 \longleftarrow X_2 \longleftarrow \cdots,$$ with the property that the relevant composites are equivalences.  Motivated by this, one could ask: given an $\E_n$ filtered spectrum $X$, when is it $\E_n$-split?  In this section, we answer this question by proving the following:

%beware, perhaps not enough definitions are made for this statement to make sense; should probably also say either spectra or functors to spectra....
\begin{thm}\label{thm:SplitMachine}
Let $X\in \Alg_{\E_n}(\Fil)$ be an $\E_n$ filtered spectrum.  Suppose there exists an $\E_n$ cofiltered spectrum $Y\in \Alg_{\E_n}(\Cofil)$ with the following two properties:
\begin{enumerate}
\item There is an equivalence $\colim X \simeq \lim Y$ of $\E_n$-algebras in spectra.
\item The resulting natural maps $X_i \to Y_i$ are equivalences.  
\end{enumerate}
Then, the filtered spectrum $X$ is $\E_n$-split.
\end{thm}


%1. define the Fil, Fil_n^+, etc. categories and all the random monoidal functors and stuff

%For an indexing category I, we can form I^+; may need to mess around with this a bit to say it better
We will need a few preliminary definitions.  We start by fixing a positive integer $n$.  
Let $[n]$ denote the linearly ordered set of integers $0\leq i\leq n$. For any indexing 1-category $\mathcal{D}$, denote by $\mathcal{D}^{ds}$ the underlying discrete category, and denote by $\mathcal{D}^+$ the the category formed by formally adding a final object, which we will refer to as ``$+$''.  Define $\Fil_n^+ = \Fun([n]^+, \Sp)$ and $\Cofil_n^+ = \Fun(([n]^+)^{op},\Sp).$  These categories admit functors to $\Sp$ by restriction to the distinguished point.  We define $\C_n$ by the following pullback:

$$
\begin{tikzcd}
\C_n \arrow[r] \arrow[d]&  \Cofil_n^+ \arrow[d]\\
\Fil_n^+ \arrow[r]& \Sp
\end{tikzcd}
$$


%2. Write down the pullback; identify the full subcategory as the image of Gr_n x Sp^J.
An element of $\C_n$ can be thought of as a sequence of spectra connected by maps:
\begin{center}
$X_0 \longrightarrow X_1 \longrightarrow \cdots \longrightarrow X_n \longrightarrow X \simeq Y \longrightarrow Y_n \longrightarrow \cdots \longrightarrow Y_1 \longrightarrow Y_0$
\end{center}
where the middle arrow is an equivalence, as indicated.  This is equivalent to just considering sequences
\begin{center}
$X_0 \longrightarrow X_1 \longrightarrow \cdots \longrightarrow X_n \longrightarrow Z \longrightarrow Y_n \longrightarrow \cdots \longrightarrow Y_1 \longrightarrow Y_0$,
\end{center}
and so we shall refer to general elements by these names below.   


Define the subcategory $\mathcal{G}_n\subset \C_n$ as the full subcategory such that for each integer $0\leq i\leq n$, the composite $X_i \longrightarrow Y_i$ is an equivalence.  

\begin{lem}
There is an equivalence $$\mathcal{G}_n \simeq \Gr_n^+ := \Fun(([n]^{+})^{ds}, \Sp),$$
where $([n]^+)^{ds}$ is, as usual, the underlying set of $[n]^+$.  
\end{lem}
\begin{proof}
We proceed by induction on $n$.  

For $n=0$, we are considering the full subcategory of diagrams $X_0 \to Z \to Y_0$ of spectra with the property that the composite is an equivalence.  By taking the fiber of the second map, this is equivalent to the category of triples $(X_0, Y_0',Z)$ of spectra together with an equivalence $X_0 \vee Y_0' \xrightarrow{\sim} Z.$   This is  certainly equivalent to the category of pairs $(X_0, Y_0')$ of spectra, which is $\Gr_0^+.$  

Next, assume the statement for $n\leq k$ and consider $\mathcal{G}_{k+1}.$  We consider the auxiliary category $\overline{\mathcal{G}}_{k+1}$ which is the full subcategory of $\C_{k+1}$ where only $X_{k+1} \to Y_{k+1}$ is stipulated to be an equivalence.    The argument for the base case shows that $$\overline{\mathcal{G}}_{k+1} = \Fil_k \times_{\Sp} \Gr_0^+ \times_{\Sp} \Cofil_k$$ where the fiber products are over the restriction to $0\in [0]^+$ for $\Gr_0^+$, and over $X_{k+1}$ and $Y_{k+1}$ in the filtered and cofiltered spectra.  By commuting the fiber products, we find that $$\overline{\mathcal{G}}_{k+1} = \C_k \times_{\Sp} \Gr_0^+.$$  Under this equivalence, the full subcategory $\mathcal{G}_{k+1} \subset \overline{\mathcal{G}}_{k+1}$ corresponds to $\mathcal{G}_k \times_{\Sp} \Gr_0^+ \simeq \Gr_{k+1}^+$ as desired.  

\end{proof}



In fact, the functor $\Gr_n^+ \to \C_n$ can be seen very explicitly as follows: theres a functor $$I_n^+: \Gr_n^+ \to \Fil_n^+$$ given by left Kan extension along the inclusion $([n]^+)^{ds} \to [n]^+$ which is completely analogous to the functor $I$ described in Section \ref{sec:FilGra}.  Dually, there's a functor $$I_n^{op,+}:\Gr_n^+ \to \Cofil_n^+$$ given by right Kan extension along the inclusion $([n]^+)^{ds} \to ([n]^+)^{op}$ which sends an element $(X_0, X_1, \cdots, X_n, X)\in \Gr_n^+$ to $$X_0 \longleftarrow X_0\vee X_1 \longleftarrow \cdots \longleftarrow \bigvee_i X_i \longleftarrow X \vee \bigvee_i X_i.$$  These functors agree on restriction to the distinguished object, and so they define the desired functor $\Gr_n^+ \to \C_n.$  


%3. Identify everything as monoidal, then take the limit n-> \infty.



Until this point, we have been working with a fixed $n$ and without regard to the monoidal structure.  The key to moving further is the following theorem of Lurie:

\begin{thm}[\cite{LurieRot}, Corollary 2.3.8]\label{thm:LurDay}%maybe this can be stated earlier.  
The construction which sends an $\infty$-category $\mathcal{D}$ to the functor category $\Fun(\mathcal{D}^{op}, \Sp)$ determines a symmetric monoidal functor from the $\infty$-category of $\infty$-categories to the $\infty$-category of presentable stable $\infty$-categories.  
\end{thm}

In particular, this implies that if $\D$ is a symmetric monoidal category, then $\Fun(\D, \Sp)$ has a natural symmetric monoidal structure, and for any symmetric monoidal functor $\D_1\to \D_2$, left Kan extension yields a symmetric monoidal functor $\Fun(\D_1,\Sp) \to \Fun(\D_2,\Sp).$  

To apply this to our situation, we give $[n]^+$ the structure of a symmetric monoidal category by taking $\Z_{\geq 0}$ under addition and identifying all the integers $m >n$ with the point $+$.  There are natural symmetric monoidal functors $[n+1]^+ \to [n]^+$ by successive quotient.  By Theorem \ref{thm:LurDay} combined with the commutative diagram of symmetric monoidal functors

$$
\begin{tikzcd}
(\lbrack n+1\rbrack^+)^{ds} \arrow[r] \arrow[d] & \lbrack n+1\rbrack^+ \arrow[d]\\
(\lbrack n\rbrack^+)^{ds} \arrow[r] & \lbrack n\rbrack^+ ,
\end{tikzcd}
$$
we obtain a commutative diagram of symmetric monoidal $\infty$-categories:
$$
\begin{tikzcd}
\Gr_{n+1}^+ \arrow[r,"I_{n+1}^+"] \arrow[d] & \Fil_{n+1}^+ \arrow[d]\\
\Gr_n^+  \arrow[r,"I_n^+"] & \Fil_n^+ .
\end{tikzcd}
$$
We remark that the right vertical functor coincides with the restriction induced by the natural inclusion $[n] \to [n+1]$.  As a consequence, $\lim_n \Fil_n^+ = \Fun(\Z_{\geq 0}^+, \Sp) =: \Fil^+$.  

There is a similar diagram for the cofiltered side. (TODO, once we figure out how to say the cofiltered convolution) %Need to justify this once I figure out what to do about monoidal structure on cofil; define Cofil^+ while you're at it.

Thus, taking the limit in $n$ in the original picture yields a diagram of symmetric monoidal functors:

$$%change this to a twisty diagram where we've labelled I^+.
\begin{tikzcd}
\mathcal{G}_\infty \arrow[r] &\C_\infty \arrow[r] \arrow[d]&  \Cofil^+ \arrow[d]\\
& \Fil^+ \arrow[r]& \Sp
\end{tikzcd}
$$
where the square is Cartesian.

\begin{rmk}
While $\mathcal{G}_\infty \to \mathcal{C}_\infty$ remains a fully faithful functor, we warn the reader that $\mathcal{G}_\infty$ is not simply $\Fun((\Z_{\geq 0}^+)^{ds}, \Sp)$ because the maps in the inverse system for $\mathcal{G}$ are not just the ones induced by the inclusions $([n]^+)^{ds} \to ([n+1]^+)^{ds}.$
\end{rmk}


Recall that we were interested in understanding when an $\E_n$ filtered spectrum $X\in \Alg_{\E_n}(\Fil)$ is split - that is, when there exists $Z\in \Alg_{\E_n}(\Gr)$ such that $X \simeq IZ.$  The following proposition is key in relating that to our current situation; informally, it allows us to get rid of the +'s.

\begin{prop}\label{prop:MonRet}
There exists a diagram of symmetric monoidal $\infty$-categories and symmetric monoidal functors 
$$
\begin{tikzcd}
&\mathcal{G}_\infty \arrow[r,"\pi"] \arrow[d, "I^+"]&  \Gr \arrow[d, "I"]\\
\Fil \arrow[r,"\iota"] & \Fil^+ \arrow[r,"\varpi"]& \Fil
\end{tikzcd}
$$
where the bottom row is a retract and $I^+$ is induced by the $I_n^+$ at each finite level.  
\end{prop} 
\begin{proof}
We have already seen that $I^+$ is symmetric monoidal.  For the bottom row, simply apply Theorem \ref{thm:LurDay} to the sequence $$\Z_{\geq 0} \to \Z_{\geq 0}^+ \to \Z_{\geq 0}.$$

Finally, to see that $\pi$ is symmetric monoidal, we claim that at each finite level $n$, the functor $$\pi_n: \Gr_n^+ \to \Gr_n$$ is symmetric monoidal.  This is because it is localization to the full subcategory of $\Gr_n^+$ which restricts to $0$ at the element $+\in ([n]^+)^{ds}$, and the localization is clearly compatible with the monoidal structure (for example, see \cite[Proposition 2.2.1.9]{HA}).%need I say this more carefully?


%do I need to say something about taking limits of symmetric monoidal functors

\end{proof}


We are now ready to prove the main result of this section.

\begin{proof}[Proof of Theorem \ref{thm:SplitMachine}]
We use the notations of Proposition \ref{prop:MonRet}.  Since $\iota$ is lax monoidal, we obtain an $\E_n$ algebra $\iota X \in \Alg_{\E_n}(\Fil^+).$  
Similarly, since the functor $\iota^{op}: \Cofil \to \Cofil^+$ is lax monoidal, we get $\iota^{op}Y \in \Cofil^+$.  %This needs explanation.  I think this is true since lim is lax the right way
Condition (1) in the statement of the Theorem guarantees that $\iota X$ and $\iota^{op}Y$ determine an element $\mathcal{X} \in \Alg_{\E_n}(\C_{\infty})$.  Condition (2) combined with the fact that $\mathcal{G}_\infty \to \C_\infty$ is fully faithful implies that $\mathcal{X} \in \Alg_{\E_n}(\G_\infty).$  Finally, we chase through the diagram of Proposition \ref{prop:MonRet} to see that $I\pi \mathcal{X} \simeq \varpi I^+ \mathcal{X} \simeq \varpi \iota X \simeq X$ as $\E_n$ algebras in $\Fil$.  
\end{proof}




